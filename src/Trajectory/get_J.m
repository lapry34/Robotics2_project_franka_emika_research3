function J = get_J(q, orientation)
    % get_J computes the Jacobian matrix J for a given symbolic expression J_sym
    % and a vector of joint angles q.
    %
    % Inputs:
    %   q     - vector of joint angles (numeric)
    %   orientation - boolean flag to indicate if orientation should be included
    % Output:
    %   J     - numeric Jacobian matrix evaluated at q

    
    if nargin < 2
        orientation = false; % default orientation
    end
    
    % Ensure q is a column vector
    if isrow(q)
        q = q(:);
    end

    q1 = q(1);
    q2 = q(2);
    q3 = q(3);
    q4 = q(4);
    q5 = q(5);
    q6 = q(6);
    % q7 = q(7);

    a4 = 0.0825; 
    a5 =-0.0825;
    a7 = 0.088;
    % d1 = 0.333;
    d3 = 0.316; 
    d5 = 0.384; 
    d_e = 0.107;

    % hardcoded is better
    J_sym = [
        [d5*cos(q1)*sin(q3)*sin(q4) - d3*sin(q1)*sin(q2) - a4*cos(q2)*cos(q3)*sin(q1) - a5*cos(q1)*cos(q4)*sin(q3) - d5*cos(q4)*sin(q1)*sin(q2) - a4*cos(q1)*sin(q3) - a5*sin(q1)*sin(q2)*sin(q4) - a5*cos(q2)*cos(q3)*cos(q4)*sin(q1) - a7*cos(q1)*cos(q3)*cos(q6)*sin(q5) + d5*cos(q2)*cos(q3)*sin(q1)*sin(q4) + d_e*cos(q4)*cos(q6)*sin(q1)*sin(q2) - d_e*cos(q1)*cos(q6)*sin(q3)*sin(q4) - d_e*cos(q1)*cos(q3)*sin(q5)*sin(q6) - a7*cos(q4)*sin(q1)*sin(q2)*sin(q6) + a7*cos(q1)*sin(q3)*sin(q4)*sin(q6) - a7*cos(q1)*cos(q4)*cos(q5)*cos(q6)*sin(q3) - d_e*cos(q2)*cos(q3)*cos(q6)*sin(q1)*sin(q4) - d_e*cos(q1)*cos(q4)*cos(q5)*sin(q3)*sin(q6) + a7*cos(q2)*cos(q3)*sin(q1)*sin(q4)*sin(q6) + a7*cos(q2)*cos(q6)*sin(q1)*sin(q3)*sin(q5) - a7*cos(q5)*cos(q6)*sin(q1)*sin(q2)*sin(q4) + d_e*cos(q2)*sin(q1)*sin(q3)*sin(q5)*sin(q6) - d_e*cos(q5)*sin(q1)*sin(q2)*sin(q4)*sin(q6) - a7*cos(q2)*cos(q3)*cos(q4)*cos(q5)*cos(q6)*sin(q1) - d_e*cos(q2)*cos(q3)*cos(q4)*cos(q5)*sin(q1)*sin(q6), cos(q1)*(d3*cos(q2) + d5*cos(q2)*cos(q4) - a4*cos(q3)*sin(q2) + a5*cos(q2)*sin(q4) - d_e*cos(q2)*cos(q4)*cos(q6) - a5*cos(q3)*cos(q4)*sin(q2) + a7*cos(q2)*cos(q4)*sin(q6) + d5*cos(q3)*sin(q2)*sin(q4) + a7*cos(q2)*cos(q5)*cos(q6)*sin(q4) - d_e*cos(q3)*cos(q6)*sin(q2)*sin(q4) + d_e*cos(q2)*cos(q5)*sin(q4)*sin(q6) + a7*cos(q3)*sin(q2)*sin(q4)*sin(q6) + a7*cos(q6)*sin(q2)*sin(q3)*sin(q5) + d_e*sin(q2)*sin(q3)*sin(q5)*sin(q6) - a7*cos(q3)*cos(q4)*cos(q5)*cos(q6)*sin(q2) - d_e*cos(q3)*cos(q4)*cos(q5)*sin(q2)*sin(q6)), d5*cos(q3)*sin(q1)*sin(q4) - a4*cos(q1)*cos(q2)*sin(q3) - a5*cos(q3)*cos(q4)*sin(q1) - a4*cos(q3)*sin(q1) - a5*cos(q1)*cos(q2)*cos(q4)*sin(q3) + d5*cos(q1)*cos(q2)*sin(q3)*sin(q4) - d_e*cos(q3)*cos(q6)*sin(q1)*sin(q4) + a7*cos(q3)*sin(q1)*sin(q4)*sin(q6) + a7*cos(q6)*sin(q1)*sin(q3)*sin(q5) + d_e*sin(q1)*sin(q3)*sin(q5)*sin(q6) - a7*cos(q1)*cos(q2)*cos(q3)*cos(q6)*sin(q5) - a7*cos(q3)*cos(q4)*cos(q5)*cos(q6)*sin(q1) - d_e*cos(q1)*cos(q2)*cos(q6)*sin(q3)*sin(q4) - d_e*cos(q1)*cos(q2)*cos(q3)*sin(q5)*sin(q6) - d_e*cos(q3)*cos(q4)*cos(q5)*sin(q1)*sin(q6) + a7*cos(q1)*cos(q2)*sin(q3)*sin(q4)*sin(q6) - a7*cos(q1)*cos(q2)*cos(q4)*cos(q5)*cos(q6)*sin(q3) - d_e*cos(q1)*cos(q2)*cos(q4)*cos(q5)*sin(q3)*sin(q6), a5*cos(q1)*cos(q4)*sin(q2) - d5*cos(q1)*sin(q2)*sin(q4) + d5*cos(q4)*sin(q1)*sin(q3) + a5*sin(q1)*sin(q3)*sin(q4) - d5*cos(q1)*cos(q2)*cos(q3)*cos(q4) - a5*cos(q1)*cos(q2)*cos(q3)*sin(q4) + d_e*cos(q1)*cos(q6)*sin(q2)*sin(q4) - d_e*cos(q4)*cos(q6)*sin(q1)*sin(q3) - a7*cos(q1)*sin(q2)*sin(q4)*sin(q6) + a7*cos(q4)*sin(q1)*sin(q3)*sin(q6) - a7*cos(q1)*cos(q2)*cos(q3)*cos(q4)*sin(q6) + a7*cos(q1)*cos(q4)*cos(q5)*cos(q6)*sin(q2) + d_e*cos(q1)*cos(q4)*cos(q5)*sin(q2)*sin(q6) + a7*cos(q5)*cos(q6)*sin(q1)*sin(q3)*sin(q4) + d_e*cos(q5)*sin(q1)*sin(q3)*sin(q4)*sin(q6) + d_e*cos(q1)*cos(q2)*cos(q3)*cos(q4)*cos(q6) - a7*cos(q1)*cos(q2)*cos(q3)*cos(q5)*cos(q6)*sin(q4) - d_e*cos(q1)*cos(q2)*cos(q3)*cos(q5)*sin(q4)*sin(q6), -(a7*cos(q6) + d_e*sin(q6))*(cos(q3)*cos(q5)*sin(q1) + cos(q1)*cos(q2)*cos(q5)*sin(q3) + cos(q1)*sin(q2)*sin(q4)*sin(q5) - cos(q4)*sin(q1)*sin(q3)*sin(q5) + cos(q1)*cos(q2)*cos(q3)*cos(q4)*sin(q5)), a7*cos(q1)*cos(q4)*cos(q6)*sin(q2) + d_e*cos(q1)*cos(q4)*sin(q2)*sin(q6) - d_e*cos(q3)*cos(q6)*sin(q1)*sin(q5) + a7*cos(q6)*sin(q1)*sin(q3)*sin(q4) + a7*cos(q3)*sin(q1)*sin(q5)*sin(q6) + d_e*sin(q1)*sin(q3)*sin(q4)*sin(q6) - a7*cos(q1)*cos(q2)*cos(q3)*cos(q6)*sin(q4) - d_e*cos(q1)*cos(q2)*cos(q3)*sin(q4)*sin(q6) - d_e*cos(q1)*cos(q2)*cos(q6)*sin(q3)*sin(q5) + d_e*cos(q1)*cos(q5)*cos(q6)*sin(q2)*sin(q4) - d_e*cos(q4)*cos(q5)*cos(q6)*sin(q1)*sin(q3) + a7*cos(q1)*cos(q2)*sin(q3)*sin(q5)*sin(q6) - a7*cos(q1)*cos(q5)*sin(q2)*sin(q4)*sin(q6) + a7*cos(q4)*cos(q5)*sin(q1)*sin(q3)*sin(q6) + d_e*cos(q1)*cos(q2)*cos(q3)*cos(q4)*cos(q5)*cos(q6) - a7*cos(q1)*cos(q2)*cos(q3)*cos(q4)*cos(q5)*sin(q6),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
        [d3*cos(q1)*sin(q2) - a4*sin(q1)*sin(q3) + a4*cos(q1)*cos(q2)*cos(q3) + d5*cos(q1)*cos(q4)*sin(q2) + a5*cos(q1)*sin(q2)*sin(q4) - a5*cos(q4)*sin(q1)*sin(q3) + d5*sin(q1)*sin(q3)*sin(q4) + a5*cos(q1)*cos(q2)*cos(q3)*cos(q4) - d5*cos(q1)*cos(q2)*cos(q3)*sin(q4) - d_e*cos(q1)*cos(q4)*cos(q6)*sin(q2) + a7*cos(q1)*cos(q4)*sin(q2)*sin(q6) - a7*cos(q3)*cos(q6)*sin(q1)*sin(q5) - d_e*cos(q6)*sin(q1)*sin(q3)*sin(q4) - d_e*cos(q3)*sin(q1)*sin(q5)*sin(q6) + a7*sin(q1)*sin(q3)*sin(q4)*sin(q6) + d_e*cos(q1)*cos(q2)*cos(q3)*cos(q6)*sin(q4) - a7*cos(q1)*cos(q2)*cos(q3)*sin(q4)*sin(q6) - a7*cos(q1)*cos(q2)*cos(q6)*sin(q3)*sin(q5) + a7*cos(q1)*cos(q5)*cos(q6)*sin(q2)*sin(q4) - a7*cos(q4)*cos(q5)*cos(q6)*sin(q1)*sin(q3) - d_e*cos(q1)*cos(q2)*sin(q3)*sin(q5)*sin(q6) + d_e*cos(q1)*cos(q5)*sin(q2)*sin(q4)*sin(q6) - d_e*cos(q4)*cos(q5)*sin(q1)*sin(q3)*sin(q6) + a7*cos(q1)*cos(q2)*cos(q3)*cos(q4)*cos(q5)*cos(q6) + d_e*cos(q1)*cos(q2)*cos(q3)*cos(q4)*cos(q5)*sin(q6), sin(q1)*(d3*cos(q2) + d5*cos(q2)*cos(q4) - a4*cos(q3)*sin(q2) + a5*cos(q2)*sin(q4) - d_e*cos(q2)*cos(q4)*cos(q6) - a5*cos(q3)*cos(q4)*sin(q2) + a7*cos(q2)*cos(q4)*sin(q6) + d5*cos(q3)*sin(q2)*sin(q4) + a7*cos(q2)*cos(q5)*cos(q6)*sin(q4) - d_e*cos(q3)*cos(q6)*sin(q2)*sin(q4) + d_e*cos(q2)*cos(q5)*sin(q4)*sin(q6) + a7*cos(q3)*sin(q2)*sin(q4)*sin(q6) + a7*cos(q6)*sin(q2)*sin(q3)*sin(q5) + d_e*sin(q2)*sin(q3)*sin(q5)*sin(q6) - a7*cos(q3)*cos(q4)*cos(q5)*cos(q6)*sin(q2) - d_e*cos(q3)*cos(q4)*cos(q5)*sin(q2)*sin(q6)), a4*cos(q1)*cos(q3) + a5*cos(q1)*cos(q3)*cos(q4) - d5*cos(q1)*cos(q3)*sin(q4) - a4*cos(q2)*sin(q1)*sin(q3) + d_e*cos(q1)*cos(q3)*cos(q6)*sin(q4) - a5*cos(q2)*cos(q4)*sin(q1)*sin(q3) - a7*cos(q1)*cos(q3)*sin(q4)*sin(q6) - a7*cos(q1)*cos(q6)*sin(q3)*sin(q5) + d5*cos(q2)*sin(q1)*sin(q3)*sin(q4) - d_e*cos(q1)*sin(q3)*sin(q5)*sin(q6) + d_e*cos(q1)*cos(q3)*cos(q4)*cos(q5)*sin(q6) - a7*cos(q2)*cos(q3)*cos(q6)*sin(q1)*sin(q5) - d_e*cos(q2)*cos(q6)*sin(q1)*sin(q3)*sin(q4) - d_e*cos(q2)*cos(q3)*sin(q1)*sin(q5)*sin(q6) + a7*cos(q2)*sin(q1)*sin(q3)*sin(q4)*sin(q6) + a7*cos(q1)*cos(q3)*cos(q4)*cos(q5)*cos(q6) - d_e*cos(q2)*cos(q4)*cos(q5)*sin(q1)*sin(q3)*sin(q6) - a7*cos(q2)*cos(q4)*cos(q5)*cos(q6)*sin(q1)*sin(q3), a5*cos(q4)*sin(q1)*sin(q2) - d5*cos(q1)*cos(q4)*sin(q3) - a5*cos(q1)*sin(q3)*sin(q4) - d5*sin(q1)*sin(q2)*sin(q4) - d5*cos(q2)*cos(q3)*cos(q4)*sin(q1) + d_e*cos(q1)*cos(q4)*cos(q6)*sin(q3) - a5*cos(q2)*cos(q3)*sin(q1)*sin(q4) - a7*cos(q1)*cos(q4)*sin(q3)*sin(q6) + d_e*cos(q6)*sin(q1)*sin(q2)*sin(q4) - a7*sin(q1)*sin(q2)*sin(q4)*sin(q6) + d_e*cos(q2)*cos(q3)*cos(q4)*cos(q6)*sin(q1) - a7*cos(q2)*cos(q3)*cos(q4)*sin(q1)*sin(q6) + a7*cos(q4)*cos(q5)*cos(q6)*sin(q1)*sin(q2) - a7*cos(q1)*cos(q5)*cos(q6)*sin(q3)*sin(q4) + d_e*cos(q4)*cos(q5)*sin(q1)*sin(q2)*sin(q6) - d_e*cos(q1)*cos(q5)*sin(q3)*sin(q4)*sin(q6) - d_e*cos(q2)*cos(q3)*cos(q5)*sin(q1)*sin(q4)*sin(q6) - a7*cos(q2)*cos(q3)*cos(q5)*cos(q6)*sin(q1)*sin(q4), -(a7*cos(q6) + d_e*sin(q6))*(cos(q2)*cos(q5)*sin(q1)*sin(q3) - cos(q1)*cos(q3)*cos(q5) + cos(q1)*cos(q4)*sin(q3)*sin(q5) + sin(q1)*sin(q2)*sin(q4)*sin(q5) + cos(q2)*cos(q3)*cos(q4)*sin(q1)*sin(q5)), d_e*cos(q1)*cos(q3)*cos(q6)*sin(q5) + a7*cos(q4)*cos(q6)*sin(q1)*sin(q2) - a7*cos(q1)*cos(q6)*sin(q3)*sin(q4) - a7*cos(q1)*cos(q3)*sin(q5)*sin(q6) + d_e*cos(q4)*sin(q1)*sin(q2)*sin(q6) - d_e*cos(q1)*sin(q3)*sin(q4)*sin(q6) + d_e*cos(q1)*cos(q4)*cos(q5)*cos(q6)*sin(q3) - a7*cos(q2)*cos(q3)*cos(q6)*sin(q1)*sin(q4) - a7*cos(q1)*cos(q4)*cos(q5)*sin(q3)*sin(q6) - d_e*cos(q2)*cos(q3)*sin(q1)*sin(q4)*sin(q6) - d_e*cos(q2)*cos(q6)*sin(q1)*sin(q3)*sin(q5) + d_e*cos(q5)*cos(q6)*sin(q1)*sin(q2)*sin(q4) + a7*cos(q2)*sin(q1)*sin(q3)*sin(q5)*sin(q6) - a7*cos(q5)*sin(q1)*sin(q2)*sin(q4)*sin(q6) + d_e*cos(q2)*cos(q3)*cos(q4)*cos(q5)*cos(q6)*sin(q1) - a7*cos(q2)*cos(q3)*cos(q4)*cos(q5)*sin(q1)*sin(q6),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
        [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,               d5*cos(q2)*cos(q3)*sin(q4) - a4*cos(q2)*cos(q3) - d5*cos(q4)*sin(q2) - a5*sin(q2)*sin(q4) - a5*cos(q2)*cos(q3)*cos(q4) - d3*sin(q2) + d_e*cos(q4)*cos(q6)*sin(q2) - a7*cos(q4)*sin(q2)*sin(q6) - d_e*cos(q2)*cos(q3)*cos(q6)*sin(q4) + a7*cos(q2)*cos(q3)*sin(q4)*sin(q6) + a7*cos(q2)*cos(q6)*sin(q3)*sin(q5) - a7*cos(q5)*cos(q6)*sin(q2)*sin(q4) + d_e*cos(q2)*sin(q3)*sin(q5)*sin(q6) - d_e*cos(q5)*sin(q2)*sin(q4)*sin(q6) - d_e*cos(q2)*cos(q3)*cos(q4)*cos(q5)*sin(q6) - a7*cos(q2)*cos(q3)*cos(q4)*cos(q5)*cos(q6),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   sin(q2)*(a4*sin(q3) + a5*cos(q4)*sin(q3) - d5*sin(q3)*sin(q4) + a7*cos(q3)*cos(q6)*sin(q5) + d_e*cos(q6)*sin(q3)*sin(q4) + d_e*cos(q3)*sin(q5)*sin(q6) - a7*sin(q3)*sin(q4)*sin(q6) + a7*cos(q4)*cos(q5)*cos(q6)*sin(q3) + d_e*cos(q4)*cos(q5)*sin(q3)*sin(q6)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 a5*cos(q2)*cos(q4) - d5*cos(q2)*sin(q4) + d5*cos(q3)*cos(q4)*sin(q2) + d_e*cos(q2)*cos(q6)*sin(q4) + a5*cos(q3)*sin(q2)*sin(q4) - a7*cos(q2)*sin(q4)*sin(q6) + a7*cos(q2)*cos(q4)*cos(q5)*cos(q6) - d_e*cos(q3)*cos(q4)*cos(q6)*sin(q2) + d_e*cos(q2)*cos(q4)*cos(q5)*sin(q6) + a7*cos(q3)*cos(q4)*sin(q2)*sin(q6) + a7*cos(q3)*cos(q5)*cos(q6)*sin(q2)*sin(q4) + d_e*cos(q3)*cos(q5)*sin(q2)*sin(q4)*sin(q6),                                                                                                                              (a7*cos(q6) + d_e*sin(q6))*(cos(q5)*sin(q2)*sin(q3) - cos(q2)*sin(q4)*sin(q5) + cos(q3)*cos(q4)*sin(q2)*sin(q5)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  a7*cos(q2)*cos(q4)*cos(q6) + d_e*cos(q2)*cos(q4)*sin(q6) + d_e*cos(q2)*cos(q5)*cos(q6)*sin(q4) + a7*cos(q3)*cos(q6)*sin(q2)*sin(q4) - a7*cos(q2)*cos(q5)*sin(q4)*sin(q6) + d_e*cos(q3)*sin(q2)*sin(q4)*sin(q6) + d_e*cos(q6)*sin(q2)*sin(q3)*sin(q5) - a7*sin(q2)*sin(q3)*sin(q5)*sin(q6) - d_e*cos(q3)*cos(q4)*cos(q5)*cos(q6)*sin(q2) + a7*cos(q3)*cos(q4)*cos(q5)*sin(q2)*sin(q6),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
        [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -sin(q1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   cos(q1)*sin(q2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         cos(q3)*sin(q1) + cos(q1)*cos(q2)*sin(q3),                                                                                                                                                                   sin(q1)*sin(q3)*sin(q4) + cos(q1)*cos(q4)*sin(q2) - cos(q1)*cos(q2)*cos(q3)*sin(q4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               cos(q3)*cos(q5)*sin(q1) + cos(q1)*cos(q2)*cos(q5)*sin(q3) + cos(q1)*sin(q2)*sin(q4)*sin(q5) - cos(q4)*sin(q1)*sin(q3)*sin(q5) + cos(q1)*cos(q2)*cos(q3)*cos(q4)*sin(q5), cos(q1)*cos(q2)*cos(q3)*cos(q6)*sin(q4) - cos(q6)*sin(q1)*sin(q3)*sin(q4) - cos(q3)*sin(q1)*sin(q5)*sin(q6) - cos(q1)*cos(q4)*cos(q6)*sin(q2) - cos(q1)*cos(q2)*sin(q3)*sin(q5)*sin(q6) + cos(q1)*cos(q5)*sin(q2)*sin(q4)*sin(q6) - cos(q4)*cos(q5)*sin(q1)*sin(q3)*sin(q6) + cos(q1)*cos(q2)*cos(q3)*cos(q4)*cos(q5)*sin(q6)];
        [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cos(q1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   sin(q1)*sin(q2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         cos(q2)*sin(q1)*sin(q3) - cos(q1)*cos(q3),                                                                                                                                                                   cos(q4)*sin(q1)*sin(q2) - cos(q1)*sin(q3)*sin(q4) - cos(q2)*cos(q3)*sin(q1)*sin(q4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               cos(q2)*cos(q5)*sin(q1)*sin(q3) - cos(q1)*cos(q3)*cos(q5) + cos(q1)*cos(q4)*sin(q3)*sin(q5) + sin(q1)*sin(q2)*sin(q4)*sin(q5) + cos(q2)*cos(q3)*cos(q4)*sin(q1)*sin(q5), cos(q1)*cos(q6)*sin(q3)*sin(q4) - cos(q4)*cos(q6)*sin(q1)*sin(q2) + cos(q1)*cos(q3)*sin(q5)*sin(q6) + cos(q2)*cos(q3)*cos(q6)*sin(q1)*sin(q4) + cos(q1)*cos(q4)*cos(q5)*sin(q3)*sin(q6) - cos(q2)*sin(q1)*sin(q3)*sin(q5)*sin(q6) + cos(q5)*sin(q1)*sin(q2)*sin(q4)*sin(q6) + cos(q2)*cos(q3)*cos(q4)*cos(q5)*sin(q1)*sin(q6)];
        [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               cos(q2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              -sin(q2)*sin(q3),                                                                                                                                                                                                                                 cos(q2)*cos(q4) + cos(q3)*sin(q2)*sin(q4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           cos(q2)*sin(q4)*sin(q5) - cos(q5)*sin(q2)*sin(q3) - cos(q3)*cos(q4)*sin(q2)*sin(q5),                                                                                                                                                                                                                               cos(q2)*cos(q5)*sin(q4)*sin(q6) - cos(q3)*cos(q6)*sin(q2)*sin(q4) - cos(q2)*cos(q4)*cos(q6) + sin(q2)*sin(q3)*sin(q5)*sin(q6) - cos(q3)*cos(q4)*cos(q5)*sin(q2)*sin(q6)];
    ];

    

    if ~orientation
        J = J_sym(1:3,:); % Only keep the position part of the Jacobian
        return;
    end

    phi = get_phi(get_R(q)); % get the orientation angles from the rotation matrix
    E = get_E(phi); % get the differential angle vector from the orientation angles
    E_inv = inv(E); % Inverse of the differential angle vector


    J = blkdiag(eye(3,3), E_inv) * J_sym; % Append the orientation part of the Jacobian

    if isnumeric(q)
        J = double(J);
    else 
        J = vpa(J);
    end

end